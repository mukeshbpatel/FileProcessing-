import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.util.List;

@RestController
public class FileUploadController {

    @Autowired
    private FileProcessingService fileProcessingService;

    @PostMapping("/upload")
    public String uploadFile(
            @RequestParam("file") MultipartFile file,
            @RequestParam(value = "headers", required = false) List<String> headers
    ) throws Exception {
        String fileName = file.getOriginalFilename();
        if (fileName == null) {
            throw new IllegalArgumentException("File name cannot be null");
        }

        String fileExtension = fileName.substring(fileName.lastIndexOf(".") + 1).toLowerCase();

        switch (fileExtension) {
            case "csv":
                return fileProcessingService.processCsv(file, headers);
            case "xlsx":
            case "xls":
                return fileProcessingService.processExcel(file, headers);
            case "xml":
                return fileProcessingService.processXml(file, headers);
            default:
                throw new IllegalArgumentException("Unsupported file type: " + fileExtension);
        }
    }
}
